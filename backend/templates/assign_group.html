{% extends "custom_base.html" %}
{% load i18n static jazzmin admin_urls %}
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
{% get_jazzmin_settings request as jazzmin_settings %}
{% get_jazzmin_ui_tweaks as jazzmin_ui %}
{% load custom_filters %}

{% block header %}
    {% block main_head %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <title>Assign User</title>
        <!-- Font Awesome Icons -->
        <link rel="stylesheet" href="{% static "vendor/fontawesome-free/css/all.min.css" %}">

        <!-- Bootstrap and adminLTE -->
        <link rel="stylesheet" href="{% static "vendor/adminlte/css/adminlte.min.css" %}" id="adminlte-css">

        <!-- Bootswatch theme -->
        {% if jazzmin_ui.theme.name != 'default' %}
            <link rel="stylesheet" href="{{ jazzmin_ui.theme.src }}" id="jazzmin-theme" />
        {% endif %}

        {% if jazzmin_ui.dark_mode_theme %}
            <link rel="stylesheet" href="{{ jazzmin_ui.dark_mode_theme.src }}" id="jazzmin-dark-mode-theme" media="(prefers-color-scheme: dark)"/>
        {% endif %}

        <!-- Custom fixes for django -->
        <link rel="stylesheet" href="{% static "jazzmin/css/main.css" %}">

           <!-- favicons -->
        <link rel="shortcut icon" href="{% static jazzmin_settings.site_icon %}" type="image/png">
        <link rel="icon" href="{% static jazzmin_settings.site_icon %}" sizes="32x32" type="image/png">

        {% if jazzmin_settings.use_google_fonts_cdn %}
        <!-- Google Font: Source Sans Pro -->
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
        {% endif %}
        {% if jazzmin_settings.custom_css %}
        <!-- Custom CSS -->
        <link rel="stylesheet" href="{% static jazzmin_settings.custom_css %}">
        {% endif %}
    {% endblock %}
{% endblock %}

{% block body %}
    {% block top_content %}
        {% block sticky_header %}
            {{block.super}}
        {% endblock %}

        {% block sidebar %}
           {{block.super}}
        {% endblock %}

        {% block content %}
<div class="content-wrapper">
    <div class="content">
        <h1 class="h4 pr-3 mr-3 border-right">Select Role To Assign Users</h1>
        {% if success_message %}
            <p>{{ success_message }}</p>
        {% endif %}
        <form method="post" class="col-sm-6 p-0">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Assign Users</button>
        </form>
        <div class="col-sm-12">
            <h1 style="border-bottom: 2px solid black; display: inline-block; padding-bottom: 5px;">Assigned/Edit Users List</h1>

            <div class="accordion" id="accordionRoles">
                {% for role in roles %}
                    <div class="card">
                        <div class="card-header" id="heading{{ role.id }}">
                            <h2 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse{{ role.id }}" aria-expanded="true" aria-controls="collapse{{ role.id }}">
                                    {{ role.name }}
                                </button>
                            </h2>
                        </div>
                        <div id="collapse{{ role.id }}" class="collapse" aria-labelledby="heading{{ role.id }}" data-parent="#accordionRoles">
                            <div class="card-body table-responsive p-0">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Users</th>
                                            <th>Email</th>
                                            <th>Active/Deactive</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for user in role.user_set.all %}
                                            <tr>
                                                <td>{{ user.username }}</td>
                                                <td>
                                                    {{user.email}}
                                                </td>
                                                <td>
                                                    <form method="post" action="{% url 'remove_user_from_role' %}">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="role_id" value="{{ role.id }}">
                                                        <input type="hidden" name="user_id" value="{{ user.id }}">
                                                        <button type="submit" class="delete-user">
                                                        <svg width="17" height="18" viewBox="0 0 17 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M13.8554 10.1116C14.5637 9.40338 15.2719 8.69512 15.9802 7.98686C16.1835 7.78355 16.3868 7.58023 16.5901 7.37692C16.8078 7.15921 16.8078 6.79553 16.5901 6.57783C16.3725 6.36013 16.0087 6.36013 15.7911 6.57783C15.0828 7.28609 14.3745 7.99435 13.6663 8.70261C13.463 8.90592 13.2597 9.10923 13.0563 9.31255C12.8387 9.53023 12.8386 9.89396 13.0563 10.1116C13.274 10.3293 13.6377 10.3293 13.8554 10.1116Z" fill="black"/>
                                                    <path d="M11.158 4.5487C11.1574 4.72659 11.1458 4.90373 11.1229 5.08012C11.1296 5.03006 11.1363 4.97999 11.1431 4.92992C11.1146 5.13802 11.0706 5.34297 11.0109 5.54436C10.9803 5.64771 10.9445 5.74943 10.9055 5.84989C10.8959 5.87489 10.8857 5.8997 10.8755 5.92448C10.9463 5.7523 10.9067 5.85021 10.8901 5.88777C10.8685 5.93654 10.8454 5.98469 10.8218 6.03256C10.7281 6.22302 10.6172 6.40476 10.4944 6.57776C10.4668 6.61661 10.3454 6.77289 10.4718 6.6113C10.4393 6.6529 10.4055 6.6935 10.3714 6.73376C10.3032 6.81424 10.231 6.8913 10.1567 6.96613C10.0885 7.03474 10.0172 7.10019 9.94429 7.16367C9.90447 7.19832 9.86367 7.2318 9.82252 7.26486C9.74075 7.33054 9.93694 7.17776 9.85346 7.24129C9.83243 7.25729 9.81108 7.27287 9.78975 7.28845C9.61836 7.41356 9.43593 7.52316 9.24691 7.61938C9.19938 7.64357 9.15111 7.66634 9.10266 7.6886C9.07836 7.69976 9.05384 7.71041 9.02935 7.72107C9.20007 7.6468 9.10349 7.68981 9.06537 7.70516C8.96548 7.74544 8.86359 7.78058 8.76077 7.81256C8.55183 7.87754 8.33711 7.92289 8.12044 7.95253C8.1705 7.94581 8.22057 7.93907 8.27066 7.93235C7.91749 7.97818 7.56094 7.97818 7.20777 7.93235C7.25784 7.93907 7.30791 7.94581 7.35799 7.95253C7.1499 7.92406 6.94495 7.88004 6.74355 7.82041C6.64021 7.78982 6.53848 7.75394 6.43801 7.71501C6.413 7.70533 6.3882 7.69514 6.36342 7.68494C6.5356 7.75572 6.43768 7.71618 6.40013 7.69955C6.35135 7.67794 6.3032 7.65486 6.25534 7.63129C6.06488 7.53753 5.88313 7.42668 5.71011 7.30386C5.67128 7.2763 5.51501 7.15489 5.67657 7.28122C5.63498 7.24871 5.59438 7.21497 5.55412 7.18085C5.47364 7.11262 5.39657 7.04045 5.32173 6.96611C5.25313 6.89796 5.18769 6.82667 5.1242 6.75376C5.08955 6.71394 5.05607 6.67312 5.02302 6.63197C4.95733 6.5502 5.11012 6.74639 5.04659 6.6629C5.03059 6.64188 5.01501 6.62053 4.99943 6.5992C4.87431 6.42781 4.76472 6.24538 4.6685 6.05637C4.6443 6.00883 4.62154 5.96058 4.59928 5.91211C4.58812 5.88781 4.57746 5.86331 4.56681 5.83879C4.64107 6.00952 4.59807 5.91295 4.58271 5.87483C4.54243 5.77494 4.5073 5.67305 4.47531 5.57024C4.41033 5.36131 4.36499 5.14658 4.33534 4.92992C4.34206 4.97999 4.3488 5.03006 4.35552 5.08012C4.3097 4.72697 4.3097 4.37043 4.35552 4.01726C4.3488 4.06733 4.34206 4.11739 4.33534 4.16746C4.36382 3.95936 4.40783 3.75441 4.46746 3.55302C4.49806 3.44968 4.53392 3.34795 4.57286 3.24747C4.58255 3.22247 4.59274 3.19769 4.60293 3.17289C4.53216 3.34506 4.57169 3.24715 4.58832 3.20959C4.60993 3.1608 4.63302 3.11267 4.65659 3.0648C4.75035 2.87436 4.8612 2.6926 4.98401 2.5196C5.01158 2.48077 5.13298 2.32448 5.00665 2.48606C5.03916 2.44447 5.0729 2.40386 5.10703 2.3636C5.17526 2.28313 5.24742 2.20606 5.32175 2.13123C5.38989 2.06264 5.46119 1.9972 5.53412 1.93371C5.57394 1.89906 5.61476 1.86558 5.65591 1.83253C5.73768 1.76684 5.54149 1.9196 5.62497 1.8561C5.646 1.84009 5.66735 1.82451 5.68868 1.80894C5.86007 1.68382 6.0425 1.57422 6.23152 1.478C6.27907 1.45381 6.32732 1.43104 6.37579 1.40878C6.40009 1.39763 6.42459 1.38697 6.4491 1.37632C6.27838 1.45058 6.37494 1.40757 6.41306 1.39222C6.51295 1.35194 6.61484 1.3168 6.71766 1.28482C6.92658 1.21984 7.14132 1.17449 7.35797 1.14485C7.30791 1.15157 7.25784 1.15831 7.20775 1.16503C7.56092 1.1192 7.91747 1.1192 8.27064 1.16503C8.22057 1.15831 8.1705 1.15157 8.12042 1.14485C8.32851 1.17332 8.53346 1.21734 8.73486 1.27697C8.8382 1.30756 8.93993 1.34342 9.04041 1.38237C9.06541 1.39206 9.09021 1.40225 9.11499 1.41244C8.94281 1.34167 9.04073 1.3812 9.07828 1.39783C9.12708 1.41944 9.17521 1.44253 9.2231 1.4661C9.41353 1.55985 9.59528 1.6707 9.7683 1.79352C9.80715 1.82108 9.96342 1.94247 9.80184 1.81616C9.84343 1.84867 9.88403 1.88241 9.92429 1.91654C10.0048 1.98474 10.0818 2.05693 10.1567 2.13125C10.2253 2.1994 10.2907 2.2707 10.3542 2.34363C10.3889 2.38344 10.4223 2.42427 10.4554 2.46539C10.5211 2.54716 10.3683 2.35097 10.4318 2.43446C10.4478 2.45548 10.4634 2.47683 10.479 2.49817C10.6041 2.66955 10.7137 2.85198 10.8099 3.04101C10.8341 3.08853 10.8569 3.1368 10.8791 3.18528C10.8903 3.20957 10.9009 3.23407 10.9116 3.25859C10.8373 3.08787 10.8803 3.18445 10.8957 3.22257C10.936 3.32246 10.9711 3.42435 11.0031 3.52717C11.0681 3.73609 11.1134 3.95083 11.1431 4.16748C11.1363 4.11741 11.1296 4.06735 11.1229 4.01728C11.1458 4.19369 11.1574 4.37081 11.158 4.5487C11.1591 4.85671 11.4142 5.11374 11.7231 5.11374C12.0303 5.11374 12.2892 4.85673 12.2881 4.5487C12.2845 3.50785 11.9255 2.52424 11.2871 1.70779C10.6934 0.948377 9.83443 0.398269 8.90478 0.150558C8.41924 0.0211841 7.90209 -0.0263601 7.40132 0.0139394C6.85767 0.0576898 6.3527 0.194369 5.85418 0.411204C4.97751 0.792526 4.23317 1.49903 3.76748 2.32964C3.25186 3.24927 3.09815 4.30507 3.26172 5.33966C3.41243 6.29272 3.91786 7.19764 4.61738 7.85692C5.3681 8.56447 6.32443 8.97469 7.34572 9.0784C8.32795 9.17815 9.35699 8.91603 10.1855 8.38386C11.4844 7.54962 12.2827 6.09205 12.2881 4.5487C12.2892 4.24067 12.0302 3.98366 11.723 3.98366C11.4142 3.98366 11.1591 4.24071 11.158 4.5487Z" fill="black"/>
                                                    <path d="M14.3486 12.6112V15.6028C14.3486 15.7646 14.3552 15.9287 14.3363 16.0897C14.3431 16.0396 14.3498 15.9896 14.3565 15.9395C14.3455 16.0209 14.3288 16.1006 14.3064 16.1796C14.2966 16.2141 14.2846 16.2479 14.2724 16.2816C14.2514 16.3355 14.2605 16.3152 14.2994 16.221C14.2891 16.2455 14.2774 16.2694 14.2658 16.2934C14.2311 16.3647 14.1891 16.4324 14.1439 16.4975C14.0896 16.5757 14.2427 16.3776 14.1518 16.4872C14.1239 16.5209 14.0937 16.5527 14.063 16.5839C14.0384 16.6089 14.0123 16.6325 13.9862 16.6557C13.9729 16.6672 13.9595 16.6785 13.946 16.6896C13.8655 16.7564 14.0614 16.6038 13.9765 16.6649C13.9121 16.7113 13.8431 16.751 13.7724 16.7868C13.7326 16.807 13.6051 16.8566 13.7856 16.7839C13.7441 16.8006 13.7014 16.8144 13.6586 16.8274C13.5802 16.8512 13.4996 16.8665 13.4185 16.8775C13.4686 16.8708 13.5187 16.8641 13.5687 16.8574C13.3774 16.8798 13.1801 16.8696 12.9879 16.8696C12.6105 16.8696 12.233 16.8696 11.8556 16.8696C10.6581 16.8696 9.46059 16.8696 8.26309 16.8696C6.98591 16.8696 5.70874 16.8696 4.43156 16.8696C3.68746 16.8696 2.94336 16.8696 2.19926 16.8696C2.10236 16.8696 2.0067 16.8687 1.90996 16.8574C1.96003 16.8641 2.0101 16.8708 2.06018 16.8775C1.97878 16.8665 1.89908 16.8499 1.82006 16.8274C1.78559 16.8176 1.75175 16.8057 1.71807 16.7934C1.66421 16.7725 1.68443 16.7815 1.77869 16.8205C1.75417 16.8101 1.73024 16.7985 1.7063 16.7868C1.63493 16.7521 1.5673 16.7102 1.5022 16.6649C1.42395 16.6106 1.62209 16.7637 1.51248 16.6729C1.47873 16.6449 1.44695 16.6147 1.41571 16.584C1.39073 16.5594 1.36722 16.5334 1.34395 16.5072C1.33243 16.4939 1.32113 16.4805 1.31005 16.467C1.24333 16.3865 1.39585 16.5824 1.33473 16.4975C1.28836 16.4331 1.24872 16.3641 1.21284 16.2934C1.19266 16.2536 1.14312 16.1261 1.21581 16.3066C1.19908 16.2651 1.1853 16.2224 1.1723 16.1796C1.14849 16.1013 1.13315 16.0206 1.12215 15.9395C1.12887 15.9896 1.13561 16.0396 1.14233 16.0897C1.12433 15.9364 1.13006 15.7806 1.13006 15.6265C1.13006 15.3625 1.13006 15.0984 1.13006 14.8344C1.13006 14.2203 1.13006 13.6062 1.13006 12.9922C1.13006 12.6457 1.12847 12.3018 1.17333 11.9571C1.16661 12.0071 1.15987 12.0572 1.15315 12.1073C1.20112 11.7558 1.28575 11.4115 1.40651 11.0779C1.42009 11.0404 1.43448 11.0031 1.44897 10.966C1.4639 10.9277 1.52287 10.789 1.44877 10.963C1.48372 10.8809 1.52166 10.8002 1.56105 10.7201C1.63945 10.5609 1.72792 10.4067 1.82311 10.2569C1.86526 10.1906 1.9096 10.1257 1.95488 10.0614C1.9775 10.0294 2.00079 9.99776 2.02416 9.96624C2.03591 9.95052 2.04771 9.93486 2.05964 9.91928C1.95268 10.06 2.01996 9.971 2.04386 9.94107C2.15388 9.80332 2.27246 9.67254 2.39654 9.54738C2.51377 9.42915 2.63794 9.31797 2.76648 9.21221C2.79675 9.18731 2.82755 9.16303 2.8584 9.13886C2.70661 9.2578 2.85053 9.1465 2.88526 9.12126C2.95674 9.06928 3.0301 9.01987 3.1043 8.97181C3.36228 8.80469 3.46804 8.47364 3.30701 8.19871C3.15679 7.94226 2.7927 7.82836 2.53391 7.996C1.645 8.57182 0.912926 9.39298 0.484826 10.3653C0.245611 10.9086 0.101021 11.4597 0.0318845 12.049C0.00397551 12.287 0 12.5255 0 12.7646V15.8677C0 16.2901 0.116621 16.7189 0.358943 17.0679C0.678474 17.528 1.17173 17.8772 1.73246 17.9636C1.98338 18.0022 2.22334 17.9997 2.47508 17.9997H5.23798H9.17732H12.4549H13.2711C13.3334 17.9997 13.3957 18.0003 13.458 17.9975C14.0233 17.972 14.5805 17.7182 14.951 17.2863C15.287 16.8947 15.4787 16.4051 15.4787 15.8866C15.4787 15.739 15.4787 15.5915 15.4787 15.444C15.4787 14.8219 15.4787 14.1998 15.4787 13.5777C15.4787 13.2556 15.4787 12.9334 15.4787 12.6113C15.4787 12.3033 15.2217 12.0462 14.9137 12.0462C14.6057 12.0462 14.3486 12.3032 14.3486 12.6112Z" fill="black"/>
                                                </svg>

                                                    </form>
                                                </td>

                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>


        </div></div>
    {% endblock %}
    {% endblock %}
{% endblock %}

<script>
// Function to handle the toggle active button click
$('.toggle-active').click(function() {
    var userId = $(this).data('user-id');
    var isActive = $('#active_' + userId).is(':checked');

    // Send AJAX request to toggle user status
    $.ajax({
        url: '/toggle-user-status/',
        method: 'POST',
        data: {
            'user_id': userId,
            'is_active': isActive
        },
        success: function(response) {
            if (response.success) {
                // Handle successful response
                console.log('User status toggled successfully.');
            } else {
                // Handle error response
                console.error('Error:', response.message);
            }
        },
        error: function(xhr, status, error) {
            // Handle AJAX error
            console.error('AJAX Error:', error);
        }
    });
});
</script>
